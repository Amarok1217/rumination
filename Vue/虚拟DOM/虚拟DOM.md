## 真实 DOM

先来看看真实的 DOM 流程是怎样的
![DOM](https://zbd-image.oss-cn-hangzhou.aliyuncs.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20201020162213.png)

1. 生成 DOM 树：用 HTML 分析器（HTML Parsee），分析 HTML 文档，生成一个 DOM 树（DOM Tree）
2. 生成样式表：用 css 分析器，解析 css 文件和直接写在标签上的样式，生成页面的样式表。
3. 构建 render 树：将 DOM 树和样式表结合起来，生成一个 Attachment。每个 DOM 节点都有 attach 方法，接受样式信息，返回一个 render 对象，最终构建出一个 render 树
4. 确定节点坐标：根据 render 树的结构，确定每个节点在显示器上显示的坐标位置。
5. 绘制页面：调用每个节点的 paint 方法，将页面显示出来

几个注意的地方：

1. DOM 树的构建是文档加载完成开始的？ 构建 DOM 树是一个渐进过程，为达到更好的用户体验，渲染引擎会尽快将内容显示在屏幕上，它不必等到整个 HTML 文档解析完成之后才开始构建 render 树和布局。
2. Render 树是 DOM 树和 CSS 样式表构建完毕后才开始构建的？ 这三个过程在实际进行的时候并不是完全独立的，而是会有交叉，会一边加载，一边解析，以及一边渲染。
3. CSS 的解析注意点？ CSS 的解析是从右往左逆向解析的，嵌套标签越多，解析越慢。
4. JS 操作真实 DOM 的代价？我们在直接操作 DOM 的时候，频繁地修改 DOM 结构会导致浏览器频繁地进行上述的渲染步骤，导致很多次的渲染其实是无用的，因此非常浪费性能。

## 虚拟 DOM 的优点

为了避免频繁地直接操作 DOM，虚拟 DOM 应运而生。主要的思路可以理解为，用 JS 模拟出 DOM 树，将多次 DOM 操作用 JS 计算完毕，再一次性 attach 到 DOM 树上。在内存中操作 JS 效率肯定远高于浏览器重新渲染 DOM 树，所以性能提升也会相当明显。
